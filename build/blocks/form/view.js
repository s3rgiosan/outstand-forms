import*as e from"@wordpress/interactivity";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const r=(i={getConfig:()=>e.getConfig,getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store,withScope:()=>e.withScope,withSyncEvent:()=>e.withSyncEvent},o={},t.d(o,i),o),n={validators:{},register(e,t){this.validators[e]=t},get(e){return this.validators[e]},validate(e,t={}){const r=[];for(const[n,i]of Object.entries(t)){if(!1===i)continue;const t=this.get(n);t&&(t(e,!0===i?{}:i)||r.push(n))}return{isValid:0===r.length,errors:r}}};var i,o;n.register("required",(function(e){return null!=e&&""!==e})),n.register("email",(function(e){return!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)})),n.register("url",(function(e){return!e||/^https?:\/\/[^\s/$.?#].[^\s]*$/i.test(e)})),n.register("pattern",(function(e,t=""){if(!e||!t)return!0;try{return new RegExp(t).test(e)}catch{return!0}})),n.register("minLength",(function(e,t=0){return!e||0===t||e.length>=t})),n.register("maxLength",(function(e,t=0){return!e||0===t||e.length<=t}));const{state:s,actions:a}=(0,r.store)("osf/form",{state:{get fieldAriaDescribedByAttribute(){const{isValid:e,helpTextId:t,errorId:n}=(0,r.getContext)();if(t||n)return n?e?t:`${n} ${t}`:t},get fieldErrorMessage(){const{isValid:e,validationErrors:t}=(0,r.getContext)();if(e)return"";const{validationMessages:n={}}=(0,r.getConfig)("osf/form");if(!n)return"";const i=(0,r.getContext)(),{validationRules:o}=i,s=t[0];if(void 0===n?.[s])return"";let a=n[s];switch(s){case"minLength":a=a.replace("{{min}}",o.minLength);break;case"maxLength":a=a.replace("{{max}}",o.maxLength)}return a},get isFormValid(){const{formFields:e}=(0,r.getContext)("osf/form");return Object.keys(e).length>0&&Object.values(e).every(Boolean)}},actions:{handleFieldFocus(){(0,r.getContext)().isFocused=!0},handleFieldBlur(){(0,r.getContext)().isFocused=!1},handleFieldChange(){const e=(0,r.getContext)(),{ref:t}=(0,r.getElement)();e.value=t.value},handleFieldValidate(){const e=(0,r.getContext)(),{fieldId:t,value:i,validationRules:o}=e,{isValid:s,errors:a}=n.validate(i,o);e.isValid=s,e.validationErrors=a;const{ref:l}=(0,r.getElement)(),d=(0,r.getContext)("osf/form");d.formFields||(d.formFields={}),d.formFields[t]=s;const c=new CustomEvent("osf-field-validated");l.dispatchEvent(c)},handleFormSubmit:(0,r.withSyncEvent)((e=>{e.preventDefault();const{ref:t}=(0,r.getElement)();a.validateForm().then((()=>{const e=new CustomEvent("osf-form-validated");t.dispatchEvent(e)})),t.addEventListener("osf-form-validated",(0,r.withScope)((()=>{s.isFormValid&&t.submit()})))})),validateForm(){const{formFields:e}=(0,r.getContext)("osf/form"),{ref:t}=(0,r.getElement)(),n=Object.keys(e||{}).map((e=>new Promise((r=>{const n=t.querySelector(`[id="${e}"]`);if(!n)return r();const i=()=>{n.removeEventListener("osf-field-validated",i),r()};n.addEventListener("osf-field-validated",i,{once:!0});const o=new CustomEvent("osf-field-validate",{bubbles:!0});n.dispatchEvent(o)}))));return Promise.all(n)}},callbacks:{registerField(){const e=(0,r.getContext)(),{fieldId:t,isValid:n}=e,i=(0,r.getContext)("osf/form");i.formFields||(i.formFields={}),i.formFields[t]=n}}});