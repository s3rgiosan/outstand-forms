import*as e from"@wordpress/interactivity";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const n=(r={getConfig:()=>e.getConfig,getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store,withScope:()=>e.withScope,withSyncEvent:()=>e.withSyncEvent},i={},t.d(i,r),i),o={validators:{},register(e,t){this.validators[e]=t},get(e){return this.validators[e]},validate(e,t={}){const n=[];for(const[o,r]of Object.entries(t)){if(!1===r)continue;const t=this.get(o);t&&(t(e,!0===r?{}:r)||n.push(o))}return{isValid:0===n.length,errors:n}}};var r,i;o.register("required",(function(e){return null!=e&&""!==e})),o.register("minLength",(function(e,t=0){return!e||0===t||e.length>=t})),o.register("maxLength",(function(e,t=0){return!e||0===t||e.length<=t}));const{state:s,actions:a}=(0,n.store)("osf/form",{state:{get fieldAriaDescribedByAttribute(){const{isValid:e,helpTextId:t,errorId:o}=(0,n.getContext)();if(t||o)return o?e?t:`${o} ${t}`:t},get fieldErrorMessage(){const{isValid:e,validationErrors:t}=(0,n.getContext)();if(e)return"";const{validationMessages:o={}}=(0,n.getConfig)("osf/form");if(!o)return"";const r=(0,n.getContext)(),{validationRules:i}=r,s=t[0];if(void 0===o?.[s])return"";let a=o[s];switch(s){case"minLength":a=a.replace("{{min}}",i.minLength);break;case"maxLength":a=a.replace("{{max}}",i.maxLength)}return a},get isFormValid(){const{formFields:e}=(0,n.getContext)("osf/form");return Object.keys(e).length>0&&Object.values(e).every(Boolean)}},actions:{handleFieldFocus(){(0,n.getContext)().isFocused=!0},handleFieldBlur(){(0,n.getContext)().isFocused=!1},handleFieldChange(){const e=(0,n.getContext)(),{ref:t}=(0,n.getElement)();e.value=t.value},handleFieldValidate(){const e=(0,n.getContext)(),{fieldId:t,value:r,validationRules:i}=e,{isValid:s,errors:a}=o.validate(r,i);e.isValid=s,e.validationErrors=a;const{ref:l}=(0,n.getElement)(),d=(0,n.getContext)("osf/form");d.formFields||(d.formFields={}),d.formFields[t]=s;const f=new CustomEvent("osf-field-validated");l.dispatchEvent(f)},handleFormSubmit:(0,n.withSyncEvent)((e=>{e.preventDefault();const{ref:t}=(0,n.getElement)();a.validateForm().then((()=>{const e=new CustomEvent("osf-form-validated");t.dispatchEvent(e)})),t.addEventListener("osf-form-validated",(0,n.withScope)((()=>{s.isFormValid&&t.submit()})))})),validateForm(){const{formFields:e}=(0,n.getContext)("osf/form"),{ref:t}=(0,n.getElement)(),o=Object.keys(e||{}).map((e=>new Promise((n=>{const o=t.querySelector(`[id="${e}"]`);if(!o)return n();const r=()=>{o.removeEventListener("osf-field-validated",r),n()};o.addEventListener("osf-field-validated",r,{once:!0});const i=new CustomEvent("osf-field-validate",{bubbles:!0});o.dispatchEvent(i)}))));return Promise.all(o)}},callbacks:{registerField(){const e=(0,n.getContext)(),{fieldId:t,isValid:o}=e,r=(0,n.getContext)("osf/form");r.formFields||(r.formFields={}),r.formFields[t]=o}}});